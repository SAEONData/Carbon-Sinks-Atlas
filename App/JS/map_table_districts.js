var districtsjson = {
   "Alfred Nzo": {
     "name": "Alfred Nzo",
     "link": "Alfred-Nzo"
   },
   "Amajuba": {
     "name": "Amajuba",
     "link": "Amajuba"
   },
   "Amathole": {
     "name": "Amathole",
     "link": "Amathole"
   },
   "Bonajala": {
     "name": "Bonajala",
     "link": "Bojanala"
   },
   "Buffalo City": {
     "name": "Buffalo City",
     "link": "Buffalo-City"
   },
   "Cacadu": {
     "name": "Cacadu",
     "link": "Cacadu"
   },
   "Cape Winelands": {
     "name": "Cape Winelands",
     "link": "Cape-Winelands"
   },
   "Capricorn": {
     "name": "Capricorn",
     "link": "Capricorn"
   },
   "Central Karoo": {
     "name": "Central Karoo",
     "link": "Central-Karoo"
   },
   "Chris Hani": {
     "name": "Chris Hani",
     "link": "Chris-Hani"
   },
   "City of Cape Town": {
     "name": "City of Cape Town",
     "link": "City-of-Cape-Town"
   },
   "City of Johannesburg": {
     "name": "City of Johannesburg",
     "link": "City-of-Johannesburg"
   },
   "City of Tshwane": {
     "name": "City of Tshwane",
     "link": "City-of-Cape-Tshwane"
   },
   "Dr Kenneth Kaunda": {
     "name": "Dr Kenneth Kaunda",
     "link": "Dr-Kenneth-Kaunda"
   },
   "Dr Ruth Segomotsi Mompatsi": {
     "name": "Dr Ruth Segomotsi Mompatsi",
     "link": "Dr-Ruth-Segomotsi-Mompati"
   },
   "Eden": {
     "name": "Eden",
     "link": "Eden"
   },
   "Ehlanzeni": {
     "name": "Ehlanzeni",
     "link": "Ehlanzeni"
   },
   "Ekurhuleni": {
     "name": "Ekurhuleni",
     "link": "Ekurhuleni"
   },
   "eThekwini": {
     "name": "eThekwini",
     "link": "eThekwini"
   },
   "Fezile Dabi": {
     "name": "Fezile Dabi",
     "link": "Fezile-Dabi"
   },
   "Frances Baard": {
     "name": "Frances Baard",
     "link": "Frances-Baard"
   },
   "Gert Sibande": {
     "name": "Gert Sibande",
     "link": "Gert-Sibande"
   },
   "Harry Gwala": {
     "name": "Harry Gwala",
     "link": "Harry-Gwala"
   },
   "iLembe": {
     "name": "iLembe",
     "link": "iLembe"
   },
   "Joe Gqabi": {
     "name": "Joe Gqabi",
     "link": "Joe-Gqabi"
   },
   "John Taolo Gaetsewe": {
     "name": "John Taolo Gaetsewe",
     "link": "John-Taolo-Gaetsewe"
   },
   "Lejweleputswa": {
     "name": "Lejweleputswa",
     "link": "Lejweleputswa"
   },
   "Mangaung": {
     "name": "Mangaung",
     "link": "Mangaung"
   },
   "Mopani": {
     "name": "Mopani",
     "link": "Mopani"
   },
   "Namakwa": {
     "name": "Namakwa",
     "link": "Namakwa"
   },
   "Nelson Mandela Bay": {
     "name": "Nelson Mandela Bay",
     "link": "Nelson-Mandela-Bay"
   },
   "Ngaka Modiri Molema": {
     "name": "Ngaka Modiri Molema",
     "link": "Ngaka-Modiri-msWriteProfilerMark"
   },
   "Nkangala": {
     "name": "Nkangala",
     "link": "Nkangala"
   },
   "O.R Tambo": {
     "name": "O.R Tambo",
     "link": "OR-Tambo"
   },
   "Overberg": {
     "name": "Overberg",
     "link": "Overberg"
   },
   "Pixley ka Seme": {
     "name": "Pixley ka Seme",
     "link": "Pixley-ka-Seme"
   },
   "Sedibeng": {
     "name": "Sedibeng",
     "link": "Sedibeng"
   },
   "Sekhukhune": {
     "name": "Sekhukhune",
     "link": "Sekhukhune"
   },
   "Thabo Mofutsanyane": {
     "name": "Thabo Mofutsanyane",
     "link": "Thabo-Mofutsanyane"
   },
   "Ugu": {
     "name": "Ugu",
     "link": "Ugu"
   },
   "Umgungundlovu": {
     "name": "Umgungundlovu",
     "link": "Umgungundlovu"
   },
   "Umkhayakude": {
     "name": "Umkhayakude",
     "link": "Umkhanyakude"
   },
   "Umzinyathi": {
     "name": "Umzinyathi",
     "link": "Umzinyathi"
   },
   "Uthukela": {
     "name": "Uthukela",
     "link": "Uthukela"
   },
   "Uthungulu": {
     "name": "Uthungulu",
     "link": "Uthungulu"
   },
   "Vhembe": {
     "name": "Vhembe",
     "link": "Vhembe"
   },
   "Waterberg": {
     "name": "Waterberg",
     "link": "Waterberg"
   },
   "West Coast": {
     "name": "West Coast",
     "link": "West-Cost"
   },
   "West Rand": {
     "name": "West Rand",
     "link": "West-Rand"
   },
   "Xhariep": {
     "name": "Xhariep",
     "link": "Xhariep"
   },
   "Z.F Mgcawu": {
     "name": "Z.F Mgcawu",
     "link": "ZF-Mgcawu"
   },
   "Zululand": {
     "name": "Zululand",
     "link": "Zululand"
   }
 }

// $(window).on('hashchange', function(){

//    setTimeout(function(){
//       mapsearch();
//      }, 2000);

// });
// $(document).ready(function(){
//    mapsearch();
// });

      // on search 
$('body').on('keyup', '#districtsearch', function(){
      // clear results
     $('#districtlisting').html('');
      // get search value
     var searchField = $('#districtsearch').val();
     // change search value to use .search function
     var expression = new RegExp(searchField, "i");

     // function to match searched terms with JSON object keys
   $.each(districtsjson, function(index, value){
      if (value.name.search(expression) != -1)
      {
         // append search results
         $('#districtlisting').fadeIn(300).append('<li id="'+index+'"class="list-group-item link-class"> '+value.name+' <span class="list-link" link="'+value.link+'">view</span></li>');
      }
   }); 

   $('.list-link').on('click',function(){
      var districtpage = $(this).attr('link');
      //console.log(tooltiplink);
      location.hash = "/districts/"+districtpage+"";
   });

});

var munid = ""
    // Function to hide listing drop down when click away from element
   $(document).click(function(e){
      var container = $("#districtlisting");
      if (!container.is(e.target) && container.has(e.target).length === 0) 
      {
         container.fadeOut(300);
      }
   });

   // Function to update table results with selected municipality
    $('body').on('click','#districtlisting li',function(){
      // get the ID of the municipality which is clicked on
      munid = $(this).attr('id');
      maptooltip()
    });




// Function to show Municipality Table 
function showMunTable(){
   $('body').find('.stats-prov').css( "opacity", "1" );
}


  // Function on map click
  $('body').on('click', '#mapsdistricts g', function(){
   munid = $(this).attr('label');
   // remove all active classes
   maptooltip();
  });
function maptooltip(){
   var activeg = $('#mapsdistricts g[label="'+munid+'"]')
   $('#mapsdistricts g').removeClass('activepath');
   $(activeg).addClass('activepath');
   // get path position and place tooltip there
   var activepath = $( ".activepath" );
   var position = activepath.position();
   console.log(position)
   var tooltip = $( ".maptooltip" );
   $(tooltip).fadeIn(300);
   tooltip.offset({ top: position.top, left: position.left });

   // get active municipality values
  // tooltipname = districtsjson[""+munid+""].name;
   tooltiplink = districtsjson[""+munid+""].link;
   // populate tooltip with this content
   tooltip.html('<div class="maptooltipinner"><h6>'+munid+'</h6><p><button class="btn btn-ea-green">view assessment</button></p></div>');
   $('.maptooltipinner button').on('click',function(){
      location.hash = "/districts/"+tooltiplink+"";
   });

    
  }

//   $('body').on('click','#districtsearch',function(){
     
//    $('#mapsdistricts g').each(function(){
//       $('path').css( "fill", "rgb(46, 125, 50)" );
       
//        $('path').css ({
//            "opacity": randomOpacity
//        });
       
//        // var maplabel = $(this).attr('class');
//        // console.log(maplabel);
//        // //this wrapped in jQuery will give us the current .letter-q div
//        // $('#extractlist').append(maplabel + '<br />');
           
//    });
//   })
//   function randomOpacity(){
// var opac = 0;
//     opac =  Math.floor(Math.random() * (99 - 35)) + 35;
//     thenumber = "0."+ opac
//     return thenumber;
// }