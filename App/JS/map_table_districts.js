var districtsjson = {
  "Alfred Nzo": {
    "name": "Alfred Nzo",
    "link": "Alfred-Nzo",
    "pdf": "Alfred_Nzo.pdf"
  },
  "Amajuba": {
    "name": "Amajuba",
    "link": "Amajuba",
    "pdf": "Amajuba.pdf"
  },
  "Amathole": {
    "name": "Amathole",
    "link": "Amathole",
    "pdf": "Amathole.pdf"
  },
  "Bonajala": {
    "name": "Bonajala",
    "link": "Bojanala",
    "pdf": "Bojanala.pdf"
  },
  "Buffalo City": {
    "name": "Buffalo City",
    "link": "Buffalo-City",
    "pdf": "Buffalo_City.pdf"
  },
  "Cacadu": {
    "name": "Cacadu",
    "link": "Cacadu",
    "pdf": "Cacadu.pdf"
  },
  "Cape Winelands": {
    "name": "Cape Winelands",
    "link": "Cape-Winelands",
    "pdf": "Cape_Winelands.pdf"
  },
  "Capricorn": {
    "name": "Capricorn",
    "link": "Capricorn",
    "pdf": "Capricorn.pdf"
  },
  "Central Karoo": {
    "name": "Central Karoo",
    "link": "Central-Karoo",
    "pdf": "Central_Karoo.pdf"
  },
  "Chris Hani": {
    "name": "Chris Hani",
    "link": "Chris-Hani",
    "pdf": "Chris_Hani.pdf"
  },
  "City of Cape Town": {
    "name": "City of Cape Town",
    "link": "City-of-Cape-Town",
    "pdf": "City_of_Cape_Town.pdf"
  },
  "City of Johannesburg": {
    "name": "City of Johannesburg",
    "link": "City-of-Johannesburg",
    "pdf": "City-of-Johannesburg.pdf"
  },
  "City of Tshwane": {
    "name": "City of Tshwane",
    "link": "City-of-Cape-Tshwane",
    "pdf": "City_of_Cape_Tshwane.pdf"
  },
  "Dr Kenneth Kaunda": {
    "name": "Dr Kenneth Kaunda",
    "link": "Dr-Kenneth-Kaunda",
    "pdf": "Dr_Kenneth_Kaunda.pdf"
  },
  "Dr Ruth Segomotsi Mompatsi": {
    "name": "Dr Ruth Segomotsi Mompatsi",
    "link": "Dr-Ruth-Segomotsi-Mompati",
    "pdf": "Dr_Ruth_Segomotsi_Mompati.pdf"
  },
  "Eden": {
    "name": "Eden",
    "link": "Eden",
    "pdf": "Eden.pdf"
  },
  "Ehlanzeni": {
    "name": "Ehlanzeni",
    "link": "Ehlanzeni",
    "pdf": "Ehlanzeni.pdf"
  },
  "Ekurhuleni": {
    "name": "Ekurhuleni",
    "link": "Ekurhuleni",
    "pdf": "Ekurhuleni.pdf"
  },
  "eThekwini": {
    "name": "eThekwini",
    "link": "eThekwini",
    "pdf": "eThekwini.pdf"
  },
  "Fezile Dabi": {
    "name": "Fezile Dabi",
    "link": "Fezile-Dabi",
    "pdf": "Fezile_Dabi.pdf"
  },
  "Frances Baard": {
    "name": "Frances Baard",
    "link": "Frances-Baard",
    "pdf": "Frances_Baard.pdf"
  },
  "Gert Sibande": {
    "name": "Gert Sibande",
    "link": "Gert-Sibande",
    "pdf": "Gert_Sibande.pdf"
  },
  "Harry Gwala": {
    "name": "Harry Gwala",
    "link": "Harry-Gwala",
    "pdf": "Harry_Gwala.pdf"
  },
  "iLembe": {
    "name": "iLembe",
    "link": "iLembe",
    "pdf": "iLembe.pdf"
  },
  "Joe Gqabi": {
    "name": "Joe Gqabi",
    "link": "Joe-Gqabi",
    "pdf": "Joe_Gqabi.pdf"
  },
  "John Taolo Gaetsewe": {
    "name": "John Taolo Gaetsewe",
    "link": "John-Taolo-Gaetsewe",
    "pdf": "John_Taolo_Gaetsewe.pdf"
  },
  "Lejweleputswa": {
    "name": "Lejweleputswa",
    "link": "Lejweleputswa",
    "pdf": "Lejweleputswa.pdf"
  },
  "Mangaung": {
    "name": "Mangaung",
    "link": "Mangaung",
    "pdf": "Mangaung.pdf"
  },
  "Mopani": {
    "name": "Mopani",
    "link": "Mopani",
    "pdf": "Mopani.pdf"
  },
  "Namakwa": {
    "name": "Namakwa",
    "link": "Namakwa",
    "pdf": "Namakwa.pdf"
  },
  "Nelson Mandela Bay": {
    "name": "Nelson Mandela Bay",
    "link": "Nelson-Mandela-Bay",
    "pdf": "Nelson_Mandela_Bay.pdf"
  },
  "Ngaka Modiri Molema": {
    "name": "Ngaka Modiri Molema",
    "link": "Ngaka-Modiri-msWriteProfilerMark",
    "pdf": "Ngaka_Modiri_Molema.pdf"
  },
  "Nkangala": {
    "name": "Nkangala",
    "link": "Nkangala",
    "pdf": "Nkangala.pdf"
  },
  "O.R Tambo": {
    "name": "O.R Tambo",
    "link": "OR-Tambo",
    "pdf": "OR_Tambo.pdf"
  },
  "Overberg": {
    "name": "Overberg",
    "link": "Overberg",
    "pdf": "Overberg.pdf"
  },
  "Pixley ka Seme": {
    "name": "Pixley ka Seme",
    "link": "Pixley-ka-Seme",
    "pdf": "Pixley_ka_Seme.pdf"
  },
  "Sedibeng": {
    "name": "Sedibeng",
    "link": "Sedibeng",
    "pdf": "Sedibeng.pdf"
  },
  "Sekhukhune": {
    "name": "Sekhukhune",
    "link": "Sekhukhune",
    "pdf": "Sekhukhune.pdf"
  },
  "Thabo Mofutsanyane": {
    "name": "Thabo Mofutsanyane",
    "link": "Thabo-Mofutsanyane",
    "pdf": "Thabo_Mofutsanyane.pdf"
  },
  "Ugu": {
    "name": "Ugu",
    "link": "Ugu",
    "pdf": "Ugu.pdf"
  },
  "Umgungundlovu": {
    "name": "Umgungundlovu",
    "link": "Umgungundlovu",
    "pdf": "Umgungundlovu.pdf"
  },
  "Umkhayakude": {
    "name": "Umkhayakude",
    "link": "Umkhanyakude",
    "pdf": "Umkhanyakude.pdf"
  },
  "Umzinyathi": {
    "name": "Umzinyathi",
    "link": "Umzinyathi",
    "pdf": "Umzinyathi.pdf"
  },
  "Uthukela": {
    "name": "Uthukela",
    "link": "Uthukela",
    "pdf": "Uthukela.pdf"
  },
  "Uthungulu": {
    "name": "Uthungulu",
    "link": "Uthungulu",
    "pdf": "Uthungulu.pdf"
  },
  "Vhembe": {
    "name": "Vhembe",
    "link": "Vhembe",
    "pdf": "Vhembe.pdf"
  },
  "Waterberg": {
    "name": "Waterberg",
    "link": "Waterberg",
    "pdf": "Waterberg.pdf"
  },
  "West Coast": {
    "name": "West Coast",
    "link": "West-Cost",
    "pdf": "West_Cost.pdf"
  },
  "West Rand": {
    "name": "West Rand",
    "link": "West-Rand",
    "pdf": "West-Rand.pdf"
  },
  "Xhariep": {
    "name": "Xhariep",
    "link": "Xhariep",
    "pdf": "Xhariep.pdf"
  },
  "Z.F Mgcawu": {
    "name": "Z.F Mgcawu",
    "link": "ZF-Mgcawu",
    "pdf": "ZF_Mgcawu.pdf"
  },
  "Zululand": {
    "name": "Zululand",
    "link": "Zululand",
    "pdf": "Zululand.pdf"
  }
 }

// $(window).on('hashchange', function(){

//    setTimeout(function(){
//       mapsearch();
//      }, 2000);

// });
// $(document).ready(function(){
//    mapsearch();
// });

      // on search 
$('body').on('keyup', '#districtsearch', function(){
      // clear results
     $('#districtlisting').html('');
      // get search value
     var searchField = $('#districtsearch').val();
     // change search value to use .search function
     var expression = new RegExp(searchField, "i");

     // function to match searched terms with JSON object keys
   $.each(districtsjson, function(index, value){
      if (value.name.search(expression) != -1)
      {
         // append search results
         //$('#districtlisting').fadeIn(300).append('<li id="'+index+'"class="list-group-item link-class"> '+value.name+' <span class="list-link" link="'+value.link+'">view</span></li>');
         $('#districtlisting').fadeIn(300).append('<li id="'+index+'"class="list-group-item link-class"> '+value.name+' <a class="list-link" href="https://ccis.environment.gov.za/carbon-sinks/content/pdfs/districts/'+value.pdf+'" target="_blank">view</a></li>');
         //window.open('https://ccis.environment.gov.za/carbon-sinks/content/pdfs/districts/'+tooltiplink+'', '_blank');
        }
   }); 

   $('.list-link').on('click',function(){
      var districtpage = $(this).attr('link');
      //console.log(tooltiplink);
      location.hash = "/districts/"+districtpage+"";
      //window.open('http://stackoverflow.com/', '_blank');
   });

});

var munid = ""
    // Function to hide listing drop down when click away from element
   $(document).click(function(e){
      var container = $("#districtlisting");
      if (!container.is(e.target) && container.has(e.target).length === 0) 
      {
         container.fadeOut(300);
      }
   });

   // Function to update table results with selected municipality
    $('body').on('click','#districtlisting li',function(){
      // get the ID of the municipality which is clicked on
      munid = $(this).attr('id');
      maptooltip()
    });




// Function to show Municipality Table 
function showMunTable(){
   $('body').find('.stats-prov').css( "opacity", "1" );
}


  // Function on map click
  $('body').on('click', '#mapsdistricts g', function(){
   munid = $(this).attr('label');
   // remove all active classes
   maptooltip();
  });
function maptooltip(){
   var activeg = $('#mapsdistricts g[label="'+munid+'"]')
   $('#mapsdistricts g').removeClass('activepath');
   $(activeg).addClass('activepath');
   // get path position and place tooltip there
   var activepath = $( ".activepath" );
   var position = activepath.position();
   console.log(position)
   var tooltip = $( ".maptooltip" );
   $(tooltip).fadeIn(300);
   tooltip.offset({ top: position.top, left: position.left });

   // get active municipality values
  // tooltipname = districtsjson[""+munid+""].name;
   tooltiplink = districtsjson[""+munid+""].pdf;
   // populate tooltip with this content
   tooltip.html('<div class="maptooltipinner"><h6>'+munid+'</h6><p><button class="btn btn-ea-green">view assessment</button></p></div>');
   $('.maptooltipinner button').on('click',function(){
      //location.hash = "/districts/"+tooltiplink+"";
      window.open('https://ccis.environment.gov.za/carbon-sinks/content/pdfs/districts/'+tooltiplink+'', '_blank');
   });

    
  }

//   $('body').on('click','#districtsearch',function(){
     
//    $('#mapsdistricts g').each(function(){
//       $('path').css( "fill", "rgb(46, 125, 50)" );
       
//        $('path').css ({
//            "opacity": randomOpacity
//        });
       
//        // var maplabel = $(this).attr('class');
//        // console.log(maplabel);
//        // //this wrapped in jQuery will give us the current .letter-q div
//        // $('#extractlist').append(maplabel + '<br />');
           
//    });
//   })
//   function randomOpacity(){
// var opac = 0;
//     opac =  Math.floor(Math.random() * (99 - 35)) + 35;
//     thenumber = "0."+ opac
//     return thenumber;
// }